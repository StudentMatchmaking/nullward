---
layout: base.njk
---

<style>
/* Reading Progress Bar */
.reading-progress { position: fixed; top: 0; left: 0; height: 3px; background: linear-gradient(90deg, #4ade80, #22d3ee); z-index: 1001; width: 0%; transition: width 0.1s linear; }

/* Post Layout Container */
.post-body { max-width: 1300px; margin: 0 auto; display: grid; grid-template-columns: 1fr; }
@media (min-width: 1100px) {
    .post-body { grid-template-columns: 1fr 200px; gap: 3rem; padding: 0 2rem; }
}

/* Table of Contents */
.toc-sidebar { display: none; }
@media (min-width: 1100px) {
    .toc-sidebar { display: block; }
    .toc-container { position: sticky; top: 100px; padding: 1rem; background: var(--bg-secondary); border: 1px solid var(--border); max-height: calc(100vh - 140px); overflow-y: auto; }
    .toc-title { font-size: 0.65rem; letter-spacing: 0.12em; text-transform: uppercase; color: var(--text-muted); margin-bottom: 0.75rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--border); }
    .toc-list { list-style: none; }
    .toc-item { margin-bottom: 0.5rem; }
    .toc-link { color: var(--text-muted); text-decoration: none; font-size: 0.75rem; line-height: 1.35; display: block; transition: color 0.2s ease, border-color 0.2s ease; border-left: 2px solid transparent; padding-left: 0.6rem; }
    .toc-link:hover { color: var(--text-secondary); }
    .toc-link.active { color: #4ade80; border-left-color: #4ade80; }
    .toc-item.toc-h3 { margin-left: 0.5rem; }
    .toc-item.toc-h3 .toc-link { font-size: 0.7rem; color: var(--text-muted); opacity: 0.8; }
}

/* Post Header */
.post-header { padding: 10rem 2rem 4rem; max-width: 900px; margin: 0 auto; }
.post-meta { display: flex; align-items: center; gap: 1rem; font-size: 0.75rem; letter-spacing: 0.1em; color: var(--text-muted); margin-bottom: 1.5rem; text-transform: uppercase; }
.post-meta-divider { color: var(--border); }
.reading-time { display: flex; align-items: center; gap: 0.4rem; }
.reading-time svg { width: 14px; height: 14px; opacity: 0.7; }
.post-title { font-family: 'Playfair Display', Georgia, serif; font-size: clamp(2rem, 5vw, 3rem); font-weight: 400; line-height: 1.3; margin-bottom: 1.5rem; }
.post-excerpt { font-size: 1.2rem; color: var(--text-secondary); line-height: 1.7; border-left: 2px solid var(--border); padding-left: 1.5rem; margin-bottom: 2rem; }

/* Post Content */
.post-content { padding: 0 2rem 4rem; max-width: 900px; margin: 0 auto; }
.post-content h2 { font-family: 'Playfair Display', Georgia, serif; font-size: 1.6rem; font-weight: 400; margin: 3rem 0 1.5rem; color: var(--text-primary); scroll-margin-top: 100px; }
.post-content h3 { font-size: 1.2rem; font-weight: 500; margin: 2.5rem 0 1rem; color: var(--text-primary); scroll-margin-top: 100px; }
.post-content p { color: var(--text-secondary); margin-bottom: 1.5rem; font-size: 1.05rem; line-height: 1.9; }
.post-content a { color: var(--text-primary); text-decoration: underline; }
.post-content blockquote { border-left: 2px solid var(--border); padding-left: 1.5rem; margin: 2rem 0; color: var(--text-muted); font-style: italic; }
.post-content ul, .post-content ol { margin: 1.5rem 0; padding-left: 1.5rem; color: var(--text-secondary); }
.post-content li { margin-bottom: 0.5rem; line-height: 1.8; }
.post-content code { background: var(--bg-tertiary); padding: 0.2rem 0.4rem; font-size: 0.9em; border-radius: 3px; }
.post-content pre { background: var(--bg-secondary); padding: 1.5rem; overflow-x: auto; margin: 2rem 0; border: 1px solid var(--border); }
.post-content strong { color: var(--text-primary); font-weight: 500; }
.post-content hr { border: none; border-top: 1px solid var(--border); margin: 3rem 0; }

/* Post Footer */
.post-footer { padding: 3rem 2rem; max-width: 900px; margin: 0 auto; border-top: 1px solid var(--border); }
.post-tags { margin-bottom: 2rem; }
.post-tags-label { font-size: 0.7rem; letter-spacing: 0.1em; color: var(--text-muted); text-transform: uppercase; margin-bottom: 0.75rem; }
.back-link { display: inline-block; color: var(--text-muted); text-decoration: none; font-size: 0.85rem; letter-spacing: 0.05em; transition: color 0.2s ease; }
.back-link:hover { color: var(--text-primary); }
.back-link::before { content: "← "; }

/* Back to Top Button */
.back-to-top { position: fixed; bottom: 2rem; right: 2rem; width: 44px; height: 44px; background: var(--bg-secondary); border: 1px solid var(--border); color: var(--text-muted); cursor: pointer; display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: all 0.3s ease; z-index: 999; border-radius: 4px; }
.back-to-top:hover { background: var(--bg-tertiary); color: var(--text-primary); border-color: var(--text-muted); transform: translateY(-3px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
.back-to-top.visible { opacity: 1; visibility: visible; }
.back-to-top svg { width: 18px; height: 18px; }
@media (min-width: 1200px) {
    .back-to-top { bottom: 2rem; right: 2rem; }
}
</style>

<div class="reading-progress" id="reading-progress"></div>

<article>
    <header class="post-header">
        <div class="post-meta">
            <span>{{ date | dateFormat }}</span>
            <span class="post-meta-divider">·</span>
            <span class="reading-time">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                {{ content | readingTime }} min read
            </span>
        </div>
        <h1 class="post-title">{{ title }}</h1>
        {% if excerpt %}<p class="post-excerpt">{{ excerpt }}</p>{% endif %}
        {% if tags %}
        <div class="tags">
            {% for tag in tags %}{% if tag != "post" %}<a href="/tags/{{ tag | slugify }}/" class="tag">{{ tag }}</a>{% endif %}{% endfor %}
        </div>
        {% endif %}
    </header>

    <div class="post-body">
        <div class="post-main">
            <div class="post-content" id="post-content">{{ content | safe }}</div>

            <footer class="post-footer">
                {% if tags %}
                <div class="post-tags">
                    <div class="post-tags-label">Tagged in</div>
                    <div class="tags">{% for tag in tags %}{% if tag != "post" %}<a href="/tags/{{ tag | slugify }}/" class="tag">{{ tag }}</a>{% endif %}{% endfor %}</div>
                </div>
                {% endif %}
                <a href="/essays/" class="back-link">Back to all essays</a>
            </footer>
        </div>

        <aside class="toc-sidebar" id="toc-sidebar">
            <nav class="toc-container">
                <div class="toc-title">Contents</div>
                <ul class="toc-list" id="toc-list"></ul>
            </nav>
        </aside>
    </div>
</article>

<button class="back-to-top" id="back-to-top" aria-label="Back to top">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
    </svg>
</button>

<section id="subscribe">
    <div class="newsletter">
        <h2>Stay Ahead</h2>
        <p>Monthly essays on AI, economics, and the accelerating future. No spam. Unsubscribe anytime.</p>
        <form class="newsletter-form" id="subscribe-form">
            <input type="email" id="email-input" placeholder="your@email.com" required>
            <button type="submit" id="subscribe-btn">Subscribe</button>
        </form>
        <p class="newsletter-note" id="form-message">Powered by <a href="https://nullward.substack.com" target="_blank">Substack</a></p>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const postContent = document.getElementById('post-content');
    const tocList = document.getElementById('toc-list');
    const readingProgress = document.getElementById('reading-progress');
    const backToTop = document.getElementById('back-to-top');

    // Generate Table of Contents
    const headings = postContent.querySelectorAll('h2, h3');
    headings.forEach((heading, index) => {
        const id = 'heading-' + index;
        heading.id = id;

        const li = document.createElement('li');
        li.className = 'toc-item toc-' + heading.tagName.toLowerCase();

        const link = document.createElement('a');
        link.className = 'toc-link';
        link.href = '#' + id;
        link.textContent = heading.textContent;

        link.addEventListener('click', (e) => {
            e.preventDefault();
            heading.scrollIntoView({ behavior: 'smooth' });
        });

        li.appendChild(link);
        tocList.appendChild(li);
    });

    // Highlight active TOC item on scroll
    const tocLinks = document.querySelectorAll('.toc-link');
    const observerOptions = {
        rootMargin: '-100px 0px -70% 0px',
        threshold: 0
    };

    const headingObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                tocLinks.forEach(link => link.classList.remove('active'));
                const activeLink = document.querySelector(`.toc-link[href="#${entry.target.id}"]`);
                if (activeLink) activeLink.classList.add('active');
            }
        });
    }, observerOptions);

    headings.forEach(heading => headingObserver.observe(heading));

    // Reading Progress Bar
    function updateReadingProgress() {
        const article = document.querySelector('article');
        const articleTop = article.offsetTop;
        const articleHeight = article.offsetHeight;
        const windowHeight = window.innerHeight;
        const scrollTop = window.scrollY;

        const progress = Math.min(100, Math.max(0,
            ((scrollTop - articleTop + windowHeight * 0.3) / (articleHeight - windowHeight * 0.5)) * 100
        ));

        readingProgress.style.width = progress + '%';
    }

    window.addEventListener('scroll', updateReadingProgress);
    updateReadingProgress();

    // Back to Top Button
    function toggleBackToTop() {
        if (window.scrollY > 200) {
            backToTop.classList.add('visible');
        } else {
            backToTop.classList.remove('visible');
        }
    }

    // Run once on load in case already scrolled
    toggleBackToTop();

    window.addEventListener('scroll', toggleBackToTop);

    backToTop.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Newsletter form
    document.getElementById('subscribe-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const email = document.getElementById('email-input').value;
        const btn = document.getElementById('subscribe-btn');
        const msg = document.getElementById('form-message');
        btn.textContent = 'Subscribing...';
        btn.disabled = true;
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = 'https://nullward.substack.com/api/v1/free?nojs=true';
        form.target = '_blank';
        const emailField = document.createElement('input');
        emailField.name = 'email';
        emailField.value = email;
        form.appendChild(emailField);
        document.body.appendChild(form);
        form.submit();
        document.body.removeChild(form);
        setTimeout(() => {
            btn.textContent = 'Subscribed ✓';
            msg.innerHTML = 'Check your email to confirm!';
            msg.style.color = '#4ade80';
        }, 500);
    });
});
</script>
